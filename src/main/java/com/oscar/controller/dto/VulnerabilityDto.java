package com.oscar.controller.dto;

import com.oscar.controller.model.nvd.Vulnerability;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.extern.slf4j.Slf4j;

import java.util.Date;
import java.util.HashMap;
import java.util.List;

@Data
@EqualsAndHashCode(of = {"cveId"})
@Slf4j
public class VulnerabilityDto {

    private String cveId;

    private String description;

    private Float severity;

    private Date published;

    private Date modified;

    public static VulnerabilityDto fromModel(Vulnerability model) {
        VulnerabilityDto dto = new VulnerabilityDto();
        dto.setCveId(model.getCveId());
        dto.setSeverity(model.getMeta().getSeverity());
        dto.setPublished(model.getMeta().getPublished());
        dto.setModified(model.getMeta().getModified());

        try {
            HashMap<String,Object> data = (HashMap<String, Object>) model.getData().get("cve");
            data = (HashMap<String, Object>) data.get("description");
            data = (HashMap<String, Object>)((List<Object>)data.get("description_data")).get(0);
            dto.setDescription((String)data.get("value"));
        } catch (Exception e) {
            log.error("NVD wrong data format " + model.getCveId(), e);
        }

        return dto;
    }
}
